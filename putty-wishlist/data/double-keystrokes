Summary: Keystrokes are doubled if "Change Settings" is open
Class: bug
Absent-in: 0.53b 2003-05-05
Present-in: 2003-05-06 2003-04-24 2003-05-24
Priority: medium

If you bring up Change Settings mid-session and type in its parent
window, your keystrokes are mysteriously doubled.

In 2003-05-05 and before, Change Settings was modal, so this situation
could not occur. This appears to be a side effect of the config box
revamp.

OSD: When Change Settings is up, keystrokes generate WM_KEYDOWN
WM_CHAR WM_KEYUP rather than the usual WM_KEYDOWN WM_KEYUP; it's the
extra WM_CHAR that's the problem, but I don't know where it's coming
from.  Is something in the config box doing TranslateMessage() behind
our backs?

OSD: The implicit message loop in DialogBox is doing
TranslateMessage() (windlg.c, line 647).  We need to change it to use
CreateDialog and then have our own non-translating message loop:

    MSG msg;
    HWND boxhwnd;

    boxhwnd =
    CreateDialog(hinst, MAKEINTRESOURCE(IDD_MAINBOX), NULL,
			  GenericMainDlgProc);

    while (IsWindow(boxhwnd) && GetMessage(&msg, NULL, 0, 0)) {
    if (!IsDialogMessage(boxhwnd, &msg))
        DispatchMessage(&msg);
    }

This fixes the double characters, but doesn't correctly get rid of the
dialogue box because EndDialog() only works with DialogBox().  Bah.
