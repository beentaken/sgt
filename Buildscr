# -*- sh -*-
# Build script for DoIt.

module doit

# Substitute the right revision number in the README.
in doit do perl -i -pe 's/<<REV>>/$(revision)/' README

# Build the Windows binary.
delegate windows
  in doit do cmd /c vcvars32 \& nmake
  return doit/doit.exe
enddelegate
in doit do chmod +x doit.exe

# Zip and tar up the source directory.
in doit do zip -9 ../doit.zip * -x Buildscr
in . do tar --exclude=Buildscr -chzf doit.tar.gz doit

# And deliver those archives.
deliver doit.zip $@
deliver doit.tar.gz $@
